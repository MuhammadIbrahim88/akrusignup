(()=>{"use strict";var t={751:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getFixtures=void 0;const n=i(81),o=i(147),r=i(17),s=i(496),a=i(570),c=/^(\w+)[ \[\]\w]* -- ([^:]+):(\d+)/i;e.getFixtures=t=>{let e;const i=["--color","no","--fixtures","-v",t.uri.fsPath],l=(0,r.dirname)(t.uri.fsPath),u=s.workspace.getConfiguration("python.testing",t.uri).get("pytestPath")||"pytest";if("pytest"===u){const o=s.workspace.getConfiguration("python",t.uri).get("pythonPath")||"python";(0,a.log)(`Running command ${o} -m pytest ${i.join(" ")} in directory ${l}`),e=(0,n.spawnSync)(o,["-m","pytest",...i],{cwd:l})}else(0,a.log)(`Running command ${u} -m pytest ${i.join(" ")} in directory ${l}`),e=(0,n.spawnSync)(u,i,{shell:!0,cwd:l});return e.error?((0,a.log)(`Error running pytest: ${e.error}`),[]):((t,e)=>{var i;const n=[];let l={},u=null,d=t.split("\n");const g=null===(i=d.find((t=>t.startsWith("rootdir"))))||void 0===i?void 0:i.slice(9).split(",")[0].trim();d=(t=>{const e=t.findIndex((t=>t.match(c))),i=(t=t.slice(e)).findIndex((t=>t.startsWith("===")));return t.slice(0,i)})(d);const h=g||e;let f=null,p={name:"",docstring:""};function v(t){var e;let i=null!==(e=l[t.name])&&void 0!==e?e:-1;i>=0?n[i]=t:(n.push(t),l[t.name]=n.length-1)}return d.forEach((t=>{let e;if(t.startsWith(" "))p.docstring+=`${t}\n`;else if(e=t.match(c)){p.name&&v(p);const[t,i,n]=e.slice(1);p={name:t,docstring:""};const c=(0,r.isAbsolute)(i)?i:(0,r.join)(h,i);try{i!==u&&(f=(0,o.readFileSync)(c,"utf8").split(/\r?\n/),u=i),p.fileLocation=s.Uri.file(c);const t=parseInt(n,10)-1;if(f&&t<f.length){const e=f[t].indexOf(`def ${p.name}(`)+4,i=e+p.name.length;p.range=new s.Range(new s.Position(t,e),new s.Position(t,i))}}catch(t){(0,a.log)(`Unable to read file at path ${c}, ${t}`)}}})),p.name&&v(p),(0,a.log)(`Found ${n.length} fixtures`),n})(e.stdout.toString(),l)}},570:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.log=void 0;const n=i(496).window.createOutputChannel("pytest-fixtures");e.log=function(t){const e=new Date;n.appendLine(`[${e.toLocaleDateString()} - ${e.toLocaleTimeString()}] ${t}`)}},624:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PytestFixtureProvider=e.PYTHON=void 0;const n=i(17),o=i(496),r=i(751),s=i(570);e.PYTHON={language:"python",scheme:"file"};const a=(t,e,i)=>{if(e.startsWith("def test_"))return!0;let n=!1;return i>0&&(n=t.lineAt(i-1).text.startsWith("@pytest.fixture")&&e.startsWith("def ")),n};e.PytestFixtureProvider=class{constructor(){this.cache={},this._activated=!1,this.cacheFixtures=t=>{if((t=>{if(t.languageId!==e.PYTHON.language||t.uri.scheme!==e.PYTHON.scheme)return!1;const i=(0,n.parse)(t.fileName).base;return i.startsWith("test_")||i.startsWith("conftest")})(t)){(0,s.log)("File is a python test file, loading fixtures...");const e=t.uri.fsPath;this.cache[e]=(0,r.getFixtures)(t)}},this.getSuggestions=(t,e)=>{var i;(0,s.log)(`GetSuggestions: ${t.fileName}`);const n=t.lineAt(e.line).text,o=t.uri.fsPath,r=e.character;if(a(t,n,e.line)&&(null===(i=this.cache[o])||void 0===i?void 0:i.length)){const t=n.slice(0,r);if(t.includes("(")&&!t.includes(")")){const t=(t=>{const e=t.indexOf("(");return t.slice(4,e)})(n);return this.cache[o].filter((e=>e.name!==t))}}return[]}}get activated(){return this._activated}activate(t){this._activated=!0,o.window.activeTextEditor&&((0,s.log)(`Active file is ${o.window.activeTextEditor.document.fileName}, loading fixtures...`),this.cacheFixtures(o.window.activeTextEditor.document)),t.subscriptions.push(o.window.onDidChangeActiveTextEditor((t=>{t&&((0,s.log)(`Changed active file to ${t.document.fileName}, loading fixtures...`),this.cacheFixtures(t.document))})),o.workspace.onDidSaveTextDocument((t=>{const e=t.uri.fsPath;this.cache[e]&&((0,s.log)(`SavedDocument ${t.fileName}, reloading fixtures...`),this.cacheFixtures(t))})),o.languages.registerCompletionItemProvider(e.PYTHON,this),o.languages.registerDefinitionProvider(e.PYTHON,this))}provideCompletionItems(t,e,i,n){(0,s.log)(`Called provideCompletionItems: ${t.fileName}, position: ${e}`);const r=this.getSuggestions(t,e);return r.length?r.map((t=>{let e=new o.CompletionItem(t.name,o.CompletionItemKind.Field);return e.documentation=t.docstring,e})):[]}provideDefinition(t,e,i){(0,s.log)(`Called provideDefinition: ${t.fileName}, position: ${e}`);const n=t.lineAt(e.line).text;if(a(t,n,e.line)){const i=t.getWordRangeAtPosition(e),n=t.getText(i),r=this.cache[t.uri.fsPath].find((t=>t.name===n));if((null==r?void 0:r.fileLocation)&&(null==r?void 0:r.range))return new o.Location(r.fileLocation,r.range)}return[]}}},496:t=>{t.exports=require("vscode")},81:t=>{t.exports=require("child_process")},147:t=>{t.exports=require("fs")},17:t=>{t.exports=require("path")}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,i),r.exports}var n={};(()=>{var t=n;Object.defineProperty(t,"__esModule",{value:!0}),t.deactivate=t.activate=void 0;const e=new(i(624).PytestFixtureProvider);t.activate=function(t){return e.activate(t),{provider:e}},t.deactivate=function(){}})(),module.exports=n})();